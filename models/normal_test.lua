requires_numlua()

-- zero-mean normal distributions with random covariance matrices.
-- the magnitude of the matrices increases from c1 to c10.
c1 = {
   { 6.6631763e-05,-8.0923858e-07,-1.0869604e-05,-9.7857845e-06,-3.8753765e-06},
   {-8.0923858e-07, 7.4502621e-05, 4.8326243e-06,-2.4850587e-05, 1.2322729e-05},
   {-1.0869604e-05, 4.8326243e-06, 8.2166027e-05, 7.4389807e-06,-5.6010647e-07},
   {-9.7857845e-06,-2.4850587e-05, 7.4389807e-06, 4.8967426e-05,-5.3365392e-06},
   {-3.8753765e-06, 1.2322729e-05,-5.6010647e-07,-5.3365392e-06, 6.2617427e-05},
}

c2 = {
   { 5.0982184e-04, 2.8882788e-05, 7.2380072e-05,-9.4279215e-06, 3.2064714e-05},
   { 2.8882788e-05, 4.2042997e-04, 1.0020627e-05, 1.3183683e-04, 6.2749664e-05},
   { 7.2380072e-05, 1.0020627e-05, 3.2752614e-04, 1.3048047e-04,-9.1905676e-06},
   {-9.4279215e-06, 1.3183683e-04, 1.3048047e-04, 2.7041040e-04, 1.5091619e-04},
   { 3.2064714e-05, 6.2749664e-05,-9.1905676e-06, 1.5091619e-04, 3.7438361e-04},
}

c3 = {
   { 4.5321293e-03,-9.2891725e-04, 6.3723820e-04, 1.1689840e-03, 7.9279452e-04},
   {-9.2891725e-04, 4.3792034e-03, 1.6793981e-03, 3.4115578e-04, 2.6210425e-04},
   { 6.3723820e-04, 1.6793981e-03, 2.9147697e-03, 7.4978976e-04, 3.8751357e-04},
   { 1.1689840e-03, 3.4115578e-04, 7.4978976e-04, 2.5114619e-03, 4.6280459e-04},
   { 7.9279452e-04, 2.6210425e-04, 3.8751357e-04, 4.6280459e-04, 2.0290662e-03},
}

c4 = {
   { 2.2466751e-02, 1.1056023e-03,-3.3630705e-03, 1.1418366e-04,-3.5570261e-03},
   { 1.1056023e-03, 1.7855650e-02, 1.1379889e-03, 4.7491215e-06, 5.2796352e-04},
   {-3.3630705e-03, 1.1379889e-03, 2.9505476e-02, 1.0813322e-02, 4.1412062e-03},
   { 1.1418366e-04, 4.7491215e-06, 1.0813322e-02, 3.3488657e-02, 4.8856102e-03},
   {-3.5570261e-03, 5.2796352e-04, 4.1412062e-03, 4.8856102e-03, 2.9174239e-02},
}

c5 = {
   { 2.2868237e-01,-1.3560902e-02,-1.5305332e-03,-6.8914459e-02, 3.0213920e-02},
   {-1.3560902e-02, 2.0041931e-01, 4.5092201e-02, 1.2589176e-02,-1.0792841e-02},
   {-1.5305332e-03, 4.5092201e-02, 3.2792026e-01,-6.7180448e-03, 7.5585152e-03},
   {-6.8914459e-02, 1.2589176e-02,-6.7180448e-03, 2.8307764e-01, 2.3546884e-02},
   { 3.0213920e-02,-1.0792841e-02, 7.5585152e-03, 2.3546884e-02, 3.3239934e-01},
}

c6 = {
   { 2.3399262e+00, 8.7751212e-02, 2.9079144e-01,-1.5971136e-01,-1.1084342e-01},
   { 8.7751212e-02, 1.7051580e+00,-1.3723685e-01, 5.1466352e-02, 8.3843103e-03},
   { 2.9079144e-01,-1.3723685e-01, 1.1892379e+00, 1.7398264e-01, 2.8589938e-01},
   {-1.5971136e-01, 5.1466352e-02, 1.7398264e-01, 9.1184498e-01,-6.8386561e-01},
   {-1.1084342e-01, 8.3843103e-03, 2.8589938e-01,-6.8386561e-01, 2.0697199e+00},
}

c7 = {
   { 1.6369187e+01,-2.4460095e+00, 7.0189097e-01,-2.0771414e+00, 4.7415001e+00},
   {-2.4460095e+00, 1.6561553e+01,-2.9210482e-01,-8.1004016e-01,-8.9671961e-01},
   { 7.0189097e-01,-2.9210482e-01, 7.9763852e+00, 2.0033668e+00, 2.1497843e+00},
   {-2.0771414e+00,-8.1004016e-01, 2.0033668e+00, 8.2380647e+00, 2.4269384e-01},
   { 4.7415001e+00,-8.9671961e-01, 2.1497843e+00, 2.4269384e-01, 9.7782579e+00},
}

c8 = {
   { 1.1324107e+02, 1.9147447e+01, 8.1389093e+00,-7.6220784e+00, 2.1556308e+01},
   { 1.9147447e+01, 1.2992002e+02,-1.5253639e+01,-2.0890583e+00,-2.2587894e+01},
   { 8.1389093e+00,-1.5253639e+01, 1.0427116e+02,-1.5075248e+01,-4.5862287e+01},
   {-7.6220784e+00,-2.0890583e+00,-1.5075248e+01, 1.3856676e+02,-1.1880558e+01},
   { 2.1556308e+01,-2.2587894e+01,-4.5862287e+01,-1.1880558e+01, 8.2128480e+01},
}

c9 = {
   { 4.6798423e+02, 1.9778952e+02,-1.3855040e+02,-2.9067014e+02,-9.8599019e+01},
   { 1.9778952e+02, 1.0051857e+03, 2.4516539e+02,-5.6924510e+00,-1.6739400e+02},
   {-1.3855040e+02, 2.4516539e+02, 8.2173051e+02, 1.3057859e+02, 2.4797065e+02},
   {-2.9067014e+02,-5.6924510e+00, 1.3057859e+02, 7.9445385e+02, 2.5226570e+01},
   {-9.8599019e+01,-1.6739400e+02, 2.4797065e+02, 2.5226570e+01, 6.9429789e+02},
}

c10 = {
   { 3.9166423e+03,-1.0132844e+02, 1.5887191e+03,-3.6372735e+02,-3.2035452e+03},
   {-1.0132844e+02, 4.3193800e+03,-1.1720939e+03, 1.0139312e+03,-1.6290925e+03},
   { 1.5887191e+03,-1.1720939e+03, 2.5211775e+03,-3.6052478e+01,-1.1201148e+03},
   {-3.6372735e+02, 1.0139312e+03,-3.6052478e+01, 6.9927439e+03, 1.1971976e+03},
   {-3.2035452e+03,-1.6290925e+03,-1.1201148e+03, 1.1971976e+03, 6.2661624e+03},
}

c = matrix(c6);
cchol = matrix.chol(c);
m = matrix({0,0,0,0,0})
res = matrix(5,5);

model = {
   x = {
      dim = 5,
      type = "matrix",
      density = function(x) 
                   return dmvnorm_chol(x,m,cchol);
      end
   }
}

para = {
   niter = 100e3,
   nburn = 10e3,
   algorithm = "am",
   blocking = "full"
}

functional = function()
   return {x[1]^2-c[1][1], x[2]^2-c[2][2], x[3]^2-c[3][3], x[4]^2-c[4][4], x[5]^2-c[5][5]}
end
